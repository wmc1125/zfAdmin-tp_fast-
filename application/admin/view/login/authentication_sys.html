<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{$web_config.version.ver_name}</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="__STATIC__/style/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="__STATIC__/system/style/admin.css" media="all">
  <link rel="stylesheet" href="__STATIC__/system/style/login.css" media="all">
  <link rel="stylesheet" href="__STATIC__/system/style/lrtk.css" media="all">
</head>
<body>
  <div class="layadmin-user-login layadmin-user-display-show" id="LAY-user-login" style="display: none;" style="margin-top:-10px">
    <div class="layui-row layui-col-space15" style="margin:0;margin-top: -70px" >
      <div class="layui-col-sm3"></div>
      <div class="layui-col-sm6" style="height:358px; ">
          
          <!-- 代码 开始 -->
          <div id="login">
            <div class="wrapper">
                <div class="login">
                    <form class="container offset1 loginform" >
                        <div class="pad">
                            <div class="control-group">
                                <div class="controls">
                                    <input id="authorize_url" type="text" placeholder="" tabindex="1" autofocus="autofocus" class="form-control input-medium" value="{$authorize_url}" readonly="">
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <input id="email" type="text" name="email" placeholder="输入你的邮箱" tabindex="1" autofocus="autofocus" class="form-control input-medium form_email">
                                </div>
                            </div>
                        </div>
                        <input type="hidden" name="key" class="zf_key" value="">
                        <span class="layui-btn layui-btn-fluid scan_btn" >发送到邮箱</span>
                    </form>
                </div>
            </div>
            <script src="__STATIC__/style/jquery-1.8.3.min.js"></script>
            <script>
            $(function() {
                $('#login #password').focus(function() {
                    $('#owl-login').addClass('password');
                }).blur(function() {
                    $('#owl-login').removeClass('password');
                });
            });
            </script>
          </div>

          <!--  -->
      </div>
      <div class="layui-col-sm3"></div>
      
    </div>

    
    <div class="layui-trans layadmin-user-login-footer">
      
    </div>
  </div>
  <script src="__STATIC__/style/layer/layer.js"></script>  
  <script>
    layer.tips('这里是授权验证地址,如果访问不了请联系微信zifeng1788替换', '#authorize_url', {guide: 1, time: 10000});
    $('.scan_btn').on('click',function(){
        var email = $(".form_email").val();
        //获取二维码
        $.ajax({
          url:"?t=qrcode",
          data:{email},
          dataType:'json',
          type:"POST",
          success:function(res){
            if(res.result==1){
                // var qrcode =  "<img src='"+res.msg+"' />"
                var qrcode = res.msg;
                layer.confirm(qrcode, {
                  btn: ['输入Key/sc','取消'], //按钮
                  title:'消息'
                }, function(){
                  layer.prompt({title: '输入Key，并确认', formType: 1}, function(pass, index){
                    layer.close(index);
                    layer.prompt({title: '输入秘钥Sc，并确认', formType: 2}, function(text, index){
                      layer.close(index);
                      //执行保存
                      var key = pass
                      var sc = text
                      $.ajax({
                        url:"?t=save",
                        data:{email,key,sc},
                        dataType:'json',
                        type:"POST",
                        success:function(res){
                          if(res.result==1){
                              layer.msg(res.msg, {
                                offset: '15px'
                                ,icon: 1
                                ,time: 1000
                              }, function(){
                                location.href = "{:url('index/index')}";
                              });
                          }else{
                            layer.msg(res.msg)

                          }
                          
                        }
                      })
                    });
                  });
                }, function(){
                  layer.msg('你点击了取消')
                   
                });
            }else{
              layer.msg(res.msg)

            }
            
          }
        })

        


        // layer.prompt({title: '请输入邮箱', formType: 1}, function(pass, index){
        //   layer.close(index);

        //   layer.prompt({title: '随便写点啥，并确认', formType: 2}, function(text, index){
        //     layer.close(index);
        //     layer.msg('演示完毕！您的口令：'+ pass +'<br>您最后写下了：'+text);
        //   });
        // });

    })
   
     $("#login_r").on("click",function(){
        var name = $(".form_name").val();
        var pwd = $(".form_pwd").val();
        var google_code = $("#google_code").val();

      //异步获取信息
        var url = "{:url('login/authentication_sys')}";
        var data = {name:name,pwd:pwd,google_code:google_code};
        $.ajax({
          url:url,
          data:data,
          dataType:'json',
          type:"POST",
          success:function(res){
            if(res.result==1){
              layer.msg('保存成功', {
                offset: '15px'
                ,icon: 1
                ,time: 1000
              }, function(){
                location.href = "{:url('login/index')}"; //后台主页
              });
            }else{
              layer.msg(res.msg)

            }
            
          }
        })
      })
  </script>
</body>
</html>

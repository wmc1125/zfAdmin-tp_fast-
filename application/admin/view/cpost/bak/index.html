<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>子枫后台管理系统</title>
  <meta name="csrf-token" content="{{csrf_token()}}">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="{{asset('static/style/layui/css/layui.css')}}" media="all">
  <link rel="stylesheet" href="{{asset('static/system/style/admin.css')}}" media="all">
  <script src="{{asset('static/style/bootstrap/bootstrap-3.3.4.js')}}"></script>
  <link rel="stylesheet" href="{{asset('static/style/bootstrap/bootstrap-3.3.4.css')}}">
</head>
<body>
  <div class="layui-fluid">
    <div class="layui-card">
      <div class="layui-card-body">
        <div style="padding-bottom: 10px;">
          <button class="layui-btn layui-btn-sm" onclick="zfAdminShow('添加','{{url("admin/{$tpl_config['name']}/add?cid=$cid")}}')">添加</button>
{{--            <a class="layui-btn  layui-btn-danger layui-btn-sm ajax_save_oss_pic_some"  href="javascript:;">一键保存10个图片保存到oss</a>--}}
        </div>
        <table class="layui-table">
            <colgroup>
              <col width="30">
              <col width="60">
              <col width="30">
              <col width="60">
              <col width="50">
              <col width="50">
              <col width="50">
              <col>
            </colgroup>
            <thead>
              <tr>
                <th>ID</th>
                <th>标题</th>
                <th>图片</th>
                <th>分类</th>
                <th>时间</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              @foreach($list as $k=>$vo)
                <tr>
                  <td>{{$vo->id}}</td>
                  <td>{{$vo->title}}</td>
                  <td><img style="width: 50px;height: 50px" src="{{$vo->pic}}"> </td>
                  <td>
                      {{get_cate_name($tpl_config['cate_tb'],$vo->cid)}}
                      @if($vo->post_id=='' && $vo->cj_id)
{{--                          <span class="layui-badge">[图集]</span>--}}
                      @endif
                  </td>
                  <td><?php echo date("Y-m-d H:i:s",$vo->ctime); ?> </td>
                  <td>
                    <div class=" layui-form" lay-filter="component-form-element">
                       <input type="checkbox" name="status" <?php echo $vo->status==1?'checked':''; ?> lay-skin="switch" lay-text="开启|关闭" lay-filter="status_change" item="{{$vo->id}}">
                    </div>
                  </td>
                  <td>
                    <a class="layui-btn layui-btn-sm layui-btn-danger btn_del" rel="{{$vo->id}}"   href="#">删除</a>
                    <button class="layui-btn layui-btn-sm" onclick='zfAdminShow("编辑","{{url("admin/{$tpl_config['name']}/edit",['id' => $vo->id] )}}")'>编辑</button>
                      @if($vo->post_id=='' && !is_save_content_pic($vo->id,$tpl_config['post_tb']))
{{--                          <a class="layui-btn  layui-btn-danger layui-btn-sm save_content-list-pic" rel="{{$vo->id}}" href="javascript:;">保存内容图片</a>--}}
                      @endif

                      @if($vo->pic && strpos($vo->pic,'wangmingchang.com') == false)
{{--                          <a class="layui-btn  layui-btn-danger layui-btn-sm ajax_save_oss_pic" rel="{{$vo->id}}" href="javascript:;">图片保存到oss</a>--}}
                      @endif



                  </td>
                </tr>
              @endforeach
            </tbody>
          </table>
          {{ $list->links() }}
      </div>
    </div>
  </div>
  @include('admin.public.common_tool')
  <script src="{{asset('static/style/jquery-1.8.3.min.js')}}"></script>
  <script src="{{asset('static/style/layui/layui.js')}}"></script>
  <script src="{{asset('static/system/common.js')}}"></script>

  <script>
 layui.use([ 'table','element'], function(){
    var $ = layui.$
    ,form = layui.form
    ,element = layui.element
    ,table = layui.table;

    form.on('switch(status_change)', function(data){
      var id = $(this).attr("item")
      var dbname = "{{$tpl_config['post_tb']}}"
      var status = this.checked ? '1' : '0'
      console.log(id)
      $.get("{{url('admin/common/is_switch')}}",{id:id,dbname:dbname,status:status},function(res){
          if(res.result==1){
            layer.msg(res.msg, {icon: 1});
          }else{
            layer.msg(res.msg, {icon: 2});
          }
        },"json");
    });
     $(".btn_del").on("click",function(){
         var id = $(this).attr("rel");
         layer.confirm('确认删除？', {
             btn: ['删除','取消'] //按钮
         }, function(){
             //执行删除操作
             $.get("{{url('admin/common/del_post')}}",{id:id,db:"{{$tpl_config['post_tb']}}"},function(res){
                 if(res.result==1){
                     layer.msg("删除成功", {icon: 1});
                     setTimeout(function() {
                         location.reload(true);
                     }, 1000);
                 }else{
                     layer.msg(res.msg, {icon: 2});

                 }
             },"json");

         }, function(){
             //取消的操作
         });
     })
     $(".save_content-list-pic").on("click",function(){
         var id = $(this).attr("rel");
         layer.confirm('确认保存？', {
             btn: ['保存','取消'] //按钮
         }, function(){
             //执行删除操作
             $.get('{{url("admin/{$tpl_config['name']}/get_content_pic_list")}}',{id:id},function(res){
                 if(res.result==1){
                     layer.msg("保存成功", {icon: 1});
                     setTimeout(function() {
                         location.reload(true);
                     }, 1000);
                 }else{
                     layer.msg(res.msg, {icon: 2});

                 }
             },"json");

         }, function(){
             //取消的操作
         });
     });
     $(".ajax_save_oss_pic").on("click",function(){
         var id = $(this).attr("rel");
         //执行删除操作
         $.get('{{url("admin/{$tpl_config['name']}/ajax_save_oss_ali")}}',{id:id},function(res){
             if(res.result==1){
                 layer.msg(res.msg, {icon: 1});
                 setTimeout(function() {
                     location.reload(true);
                 }, 1000);
             }else{
                 layer.msg(res.msg, {icon: 2});

             }
         },"json");
     });
     $(".ajax_save_oss_pic_some").on("click",function(){
         //执行删除操作
         $.get('{{url("admin/{$tpl_config['name']}/ajax_save_oss_ali")}}',{t:'some'},function(res){
             if(res.result==1){
                 layer.msg(res.msg, {icon: 1});
                 setTimeout(function() {
                     location.reload(true);
                 }, 1000);
             }else{
                 layer.msg(res.msg, {icon: 2});

             }
         },"json");
     });





  });
  </script>
</body>
</html>
